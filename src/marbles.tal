( 3900 saturdays )

|00 @System &vector $2 &expansion $2 &wst $1 &rst $1 &metadata $2 &r $2 &g $2 &b $2 &debug $1 &state $1
|20 @Screen &vector $2 &width $2 &height $2 &auto $1 &pad $1 &x $2 &y $2 &addr $2 &pixel $1 &sprite $1
|c0 @DateTime &year $2 &month $1 &day $1 &hour $1 &minute $1 &second $1 &dotw $1 &doty $2 &isdst $1
|000

	@spent $2

|100

@on-reset ( -> )
	( | theme )
	#04f0 DUP2 .System/r DEO2
	DUP2 .System/g DEO2
	.System/b DEO2
	( | size )
	#0196 .Screen/width DEO2
	#0136 .Screen/height DEO2
	;on-frame .Screen/vector DEO2
	( calc )
	( years ) .DateTime/year DEI2
	( 1986 ) #07c2 SUB2
	( 54 ) #0034 MUL2
	( days ) .DateTime/doty DEI2 #0007 DIV2 ADD2
	( birth ) #07c2 #0003 #0016 doty #0001 SUB2 #0007 DIV2 SUB2 DUP2 .spent STZ2
	#0f3c SWP2 SUB2 <pdec>
	;dict/marbles <pstr>
	<draw-grid>
	BRK

@on-frame ( -> )
	[ LIT &f $1 ] INCk ,&f STR
	#0f NEQ ?{
		.spent LDZ2 <set-pen>
		[ LIT2 00 &color $1 ] EQU DUP ,&color STR
		#05 MUL .Screen/sprite DEO
		[ LIT2 00 _&f ] STR }
	BRK

@<draw-grid> ( -- )
	;marble-icn .Screen/addr DEO2
	#0f3c #0000
	&>l ( -- )
		DUP2 <set-pen>
		DUP2 .spent LDZ2 GTH2 INC #05 MUL .Screen/sprite DEO
		INC2 GTH2k ?&>l
	POP2 POP2
	( | text )
	[ LIT2 15 -Screen/auto ] DEO
	#0010 .Screen/x DEO2
	.Screen/height DEI2 #0018 SUB2 .Screen/y DEO2
	#0f3c .spent LDZ2 SUB2 <draw-dec>
	;dict/marbles <draw-uf2>
	( | reset pen )
	[ LIT2 00 -Screen/auto ] DEO
	;marble-icn .Screen/addr DEO2
	JMP2r

@<draw-uf2> ( text* -- )
	&>while ( -- )
		LDAk <draw-char>
		INC2 LDAk ?&>while
	POP2 JMP2r

@<draw-char> ( char -- )
	#20 SUB #00 SWP
	( addr ) DUP2 #50 SFT2 ;font/glyphs ADD2 .Screen/addr DEO2
	( move-x ) ;font ADD2 LDA #00 SWP .Screen/x DEI2 ADD2
	( draw ) [ LIT2 01 -Screen/sprite ] DEOk DEO
	.Screen/x DEO2
	JMP2r

@<draw-dec> ( value* -- )
	#2710 [ LIT2r 00fb ]
	&w ( -- )
	DIV2k #000a DIV2k MUL2 SUB2 SWPr EQUk OVR STHkr EQU AND ?{
		DUP [ LIT "0 ] ADD <draw-char>
		INCr }
	POP2 #000a DIV2 SWPr INCr STHkr ?&w
	POP2r POP2 POP2 JMP2r

@<set-pen> ( marble* -- )
	#0034
	( x ) DIV2k DUP2 #0001 AND2 #0003 MUL2 STH2
	( stagger ) #0005 MUL2 #0010 ADD2 .Screen/x DEO2
	( y ) DIV2k MUL2 SUB2 #0005 MUL2 STH2r ADD2 #0010 ADD2 .Screen/y DEO2
	JMP2r

(
@|utils )

@doty ( year* month* day* -- doty* )
	ROT2 ,&y STR2
	[ LIT2r 0000 ] SWP2 NIP #01 SUB #00 EQUk ?&skip
	&>l ( -- )
		#00 OVR [ LIT2 &y $2 ] ROT diam STH2
		ADD2r INC GTHk ?&>l
	&skip POP2 STH2r ADD2 JMP2r

@diam ( year* month -- days )
	#00 OVR ;&lut ADD2 LDA SWP #01 NEQ ?{
		STH
		DUP2 is-leap-year STHr ADD }
	NIP NIP JMP2r
	&lut [ 1f 1c 1f 1e 1f 1e 1f 1f 1e 1f 1e 1f ]

@is-leap-year ( year* -- bool )
	( leap year if divisible by 400 ) DUP2 #0190
	( mod2 ) DIV2k MUL2 SUB2 #0000 EQU2 ?&leap
	( not a leap year if divisible by 100, but not by 400 ) DUP2 #0064
	( mod2 ) DIV2k MUL2 SUB2 #0000 EQU2 ?&not-leap
	( leap year if not divisible by 100, but by 4 ) #0003 AND2 #0000 EQU2 JMP2r
	&not-leap ( -- )
	POP2 #00 JMP2r
	&leap ( -- )
	POP2 #01 JMP2r

@<pstr> ( str* -: )
	LDAk #18 DEO
	INC2 LDAk ?<pstr>
	POP2 JMP2r

@<pdec> ( short* -- )
	#2710 [ LIT2r 00fb ]
	&w ( -- )
	DIV2k #000a DIV2k MUL2 SUB2 SWPr EQUk OVR STHkr EQU AND ?{
		DUP [ LIT "0 ] ADD #18 DEO
		INCr }
	POP2 #000a DIV2 SWPr INCr STHkr ?&w
	POP2r POP2 POP2 JMP2r

(
@|assets )

@dict &marbles 20 "Marbles 20 "Left 0a $1

@marble-icn [ 60f0 f060 0000 0000 ]

@font [
	0a04 070c 0a0c 0c04 0808 0c0c 060c 050c
	0b06 0a0a 0a0a 0a0a 080a 0706 080d 080a
	100d 0f0f 0f10 100f 100d 0f10 1010 1010
	0f10 0f0f 100e 0d10 100f 0e07 0c07 090d
	0409 0907 0908 080a 0906 090a 060e 0a08
	090a 090b 0709 090e 0c0a 0c08 0608 0b0e ]
	&glyphs [
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	4060 6060 6040 4000 4060 2000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	486c 2424 0000 0000 0000 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0008 197f 1919 197f 1911 0000 0000 0000
	0080 80e0 8080 80e0 8000 0000 0000 0000
	040e 1735 1c07 0514 3d4e 0400 0000 0000
	0040 8000 0000 8080 0000 0000 0000 0000
	0020 5021 0306 0c18 3020 0000 0000 0000
	0040 c080 0000 0040 a040 0000 0000 0000
	1824 4666 1826 6363 2519 0000 0000 0000
	0000 0000 0000 6080 a0c0 8000 0000 0000
	4060 2040 0000 0000 0000 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0e10 2060 6060 6060 3018 0e00 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	7018 0c06 0606 0606 0408 7000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 2011 0b7f 0d58 3000 0000 0000 0000
	0000 c0a0 00e0 0080 4000 0000 0000 0000
	0000 0206 067f 0606 0400 0000 0000 0000
	0000 0000 00e0 0000 0000 0000 0000 0000
	0000 0000 0000 0000 2030 1020 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0000 007f 0000 0000 0000 0000 0000
	0000 0000 00e0 0000 0000 0000 0000 0000
	0000 0000 0000 0000 4070 1000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0001 0306 0c18 3060 4000 0000 0000
	2060 c080 0000 0000 0000 0000 0000 0000
	0e17 2341 4040 6070 381d 0e00 0000 0000
	0000 80c0 c040 4040 8000 0000 0000 0000
	0818 3858 1818 1818 381c 0800 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0c1e 3121 0307 0c10 3079 4700 0000 0000
	0000 0080 8000 0000 4080 0000 0000 0000
	0c1e 3141 010e 0141 311e 0c00 0000 0000
	0000 0080 8000 8080 0000 0000 0000 0000
	0103 070b 1323 7f03 0703 0100 0000 0000
	0000 0000 0000 8040 0080 0000 0000 0000
	3f3e 2027 2931 0141 311e 0c00 0000 0000
	0000 0000 8080 8080 0000 0000 0000 0000
	040e 1720 6e71 6161 211e 0c00 0000 0000
	0080 0000 0000 8080 0000 0000 0000 0000
	3f7f 0001 0204 0c0c 0c0c 0800 0000 0000
	c080 8000 0000 0000 0000 0000 0000 0000
	1824 4666 3418 2c66 6224 1800 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0c1e 2161 6325 1901 3a5c 0800 0000 0000
	0000 0080 8080 8000 0000 0000 0000 0000
	0000 0010 3810 0010 3810 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0020 3010 0000 2030 1020 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0004 0c18 3060 3018 0c04 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0000 7f00 007f 0000 0000 0000 0000
	0000 0000 e000 00e0 0000 0000 0000 0000
	0040 6030 180c 1830 6040 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	1c26 4306 0c18 1000 1018 0800 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0718 2162 6666 6762 3018 0700 0000 0000
	f00c e666 66e8 7020 0418 e000 0000 0000
	0f1f 3066 4b42 240f 103d 4e00 0000 0000
	90f0 70b0 3030 30f0 3038 1000 0000 0000
	0f1f 3142 0d0d 0901 1e27 4300 0000 0000
	c89c 2c48 90a0 d08c 0890 e000 0000 0000
	0409 1226 6e66 6634 1c0f 0700 0000 0000
	80c4 f870 0000 0004 08f0 e000 0000 0000
	0f1f 3142 040c 0c08 1e27 4300 0000 0000
	f8fc 1c0c 0c0c 0c0c 0890 e000 0000 0000
	1f3f 6284 091b 1b13 021f 2000 0000 0000
	9039 5e8c 0810 fc00 04f8 f000 0000 0000
	070f 1821 0206 0606 0604 61f6 0c08 0000
	e4ce 9723 40d0 e8c0 c080 0000 0000 0000
	0409 1226 6e66 6766 341f 0f00 0000 0000
	80c4 f870 2040 fc0c 08f0 e000 0000 0000
	0f1f 3142 040d 0d09 011f 2700 0000 0000
	c890 244e 96a6 c686 0684 c408 0804 0000
	0f1f 3142 0c3d 4d09 013e 4400 0000 0000
	c890 2040 8080 8080 0000 0000 0000 0000
	0307 0c10 0103 0f13 0302 307b 8604 0000
	f2e4 4890 2060 6060 6040 8000 0000 0000
	1f3f 6284 091b 1b13 023f 4700 0000 0000
	9039 5e80 7898 2040 3818 9000 0000 0000
	1f3f 6284 091b 1b13 021f 2000 0000 0000
	9039 5e8c 0000 0000 04f8 f000 0000 0000
	1c3f 6284 0818 1910 387f 8700 0000 0000
	84ce d6e6 c6e6 c6c6 e7ce 8400 0000 0000
	3078 9c1c 1613 1110 3c4f 8600 0000 0000
	183c 1f16 1010 90d0 7070 3000 0000 0000
	0204 0913 3733 331a 0e07 0300 0000 0000
	70f8 1c0e 0703 0302 04f8 f000 0000 0000
	0103 0703 0303 0f13 2313 0302 0400 0000
	1c26 4686 0686 c468 3000 0090 6000 0000
	0409 1226 6e66 6634 1c0f 0700 0000 0000
	e0f0 381c 0e06 6694 09f6 e400 0000 0000
	0f1f 3142 040d 0d09 011f 2300 0000 0000
	c89c 2c4c 8890 e098 0c8c c800 0000 0000
	070b 180e 0300 1c3f 4340 2418 0000 0000
	04f8 f000 c0f0 3810 e0c0 0000 0000 0000
	0f1f 3244 0919 190d 0703 0100 0000 0000
	e0f1 7e9c 8080 8001 02fc f800 0000 0000
	040c 1c0c 3c4c 0c08 1e27 0300 0000 0000
	1038 5818 1818 1818 1cb8 d000 0000 0000
	040c 1c0c 3c4c 0c08 1e27 0300 0000 0000
	2070 b030 3030 3020 4080 0000 0000 0000
	040c 1d0c 3c4c 0c08 1e27 0200 0000 0000
	42e7 6b63 6363 6362 f438 1000 0000 0000
	1038 5c0e 071f 0204 081e 2700 0000 0000
	395e 0408 10fc 7038 1d8e 0400 0000 0000
	040c 1c0c 3c4c 0c08 1e27 0300 0f13 0000
	1038 5818 1818 1818 1898 f80c 0cf0 0000
	1e27 4300 000f 0204 1f3f 4100 0000 0000
	0088 f840 80e0 0000 80c4 f800 0000 0000
	7860 6060 6060 6060 6060 7c00 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	4060 3018 0c06 0301 0000 0000 0000 0000
	0000 0000 0000 0080 c060 2000 0000 0000
	7c0c 0c0c 0c0c 0c0c 0c0c 7c00 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	081c 3600 0000 0000 0000 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0000 0000 0000 0000 0000 7f00 0000
	0000 0000 0000 0000 0000 0000 f000 0000
	2060 4020 0000 0000 0000 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 003d 4e26 166e 667a 2100 0000 0000
	0000 0000 0000 0000 0080 0000 0000 0000
	0850 3032 373b 3333 7738 1000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0018 3e74 3030 7438 1000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	7038 1c1e 3733 3333 7738 1000 0000 0000
	0000 0080 0000 0000 0000 0000 0000 0000
	0000 0018 3e73 3638 7438 1000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0d16 30fc 3030 3030 7438 1000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0012 377b 3333 773b 1120 7f8e 0000
	0000 0000 4080 0000 0000 8080 0000 0000
	0850 3032 373b 3333 733a 1201 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	1020 0010 3870 3030 7038 1000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0204 0002 070e 0606 0606 0321 5e8c 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0850 3032 373b 323c 733b 1100 0000 0000
	0000 0000 0000 0000 4080 0000 0000 0000
	0850 3030 3030 3030 7038 1000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0012 377b 3333 733b 1100 0000 0000
	0000 0028 70b0 3030 34b8 1000 0000 0000
	0000 0012 377b 3333 733b 1100 0000 0000
	0000 0000 0080 0000 4080 0000 0000 0000
	0000 000c 1667 6666 e668 3000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0012 377b 3333 337a b430 2840 0000
	0000 0000 0000 0000 0080 0000 0000 0000
	0000 0018 3673 3333 7337 1b03 0204 0000
	0000 0000 8000 0000 0000 0000 8000 0000
	0000 0012 3778 3130 7438 1000 0000 0000
	0000 0000 0080 0000 0000 0000 0000 0000
	0000 003c 6f62 3f08 103d 4f00 0000 0000
	0000 0080 0000 00c0 c080 0000 0000 0000
	0810 30fc 3030 3030 7438 1000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 0011 3377 3333 773b 1100 0000 0000
	0000 0000 0000 0000 0080 0000 0000 0000
	1020 6163 3733 3333 7638 1000 0000 0000
	0000 0000 8000 0000 0000 0000 0000 0000
	0010 2060 6233 3333 773b 2200 0000 0000
	0000 0000 2030 b830 70b8 2000 0000 0000
	0000 0010 385c 0f0b 1130 5000 0000 0000
	0000 00a0 c080 0080 d0e0 4000 0000 0000
	0000 0011 3377 3333 773b 1100 3f4e 0000
	0000 0000 8000 0000 0000 8080 0000 0000
	0000 001e 3940 0f02 041c 2300 0000 0000
	0000 0020 c080 e000 10e0 c000 0000 0000
	000e 1830 30e0 3030 180e 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0000 3030 3000 3030 3000 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	0070 180c 0c07 0c0c 1870 0000 0000 0000
	0000 0000 0000 0000 0000 0000 0000 0000
	3c4e 0700 0000 0000 0000 0000 0000 0000
	0040 8000 0000 0000 0000 0000 0000 0000
	0e71 0e71 0e71 0e71 0e71 0e71 0e71 0000
	38c0 38c0 38c0 38c0 38c0 38c0 38c0 0000 ]

