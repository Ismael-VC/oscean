<!DOCTYPE html><html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../links/main.css" type="text/css" rel="stylesheet"><link href="../media/services/icon.png" type="image/png" rel="shortcut icon">
<title>XXIIVV &mdash; devlog</title></head><body>
<header><a href="home.html"><img alt="XXIIVV" src="../media/icon/logo.svg"></a></header>

<nav><ul><li><a href="identity.html">identity</a></li><li><a href="journal.html" class="parent">journal</a></li><li><a href="index.html">index</a></li><li><a href="faqs.html">faqs</a></li></ul><ul><li><a href="calendar.html">calendar</a></li><li><a href="blog.html">blog</a></li><li><a href="devlog.html" class="self">devlog</a></li><li><a href="now.html">now</a></li></ul><ul><li><a href="uxn_devlog.html">uxn devlog</a></li><li><a href="varvara_devlog.html">varvara devlog</a></li><li><a href="uxntal_devlog.html">uxntal devlog</a></li></ul></nav>
<main><figure><img alt="FUCK COMPUTERS #3" src="../media/diary/790.jpg"><figcaption>FUCK COMPUTERS #3</figcaption></figure>
<h2>The devlog is a collection of design notes.</h2>

<p>Below are disjointed thoughts on the creation of a <i>clean-slate computing
stack</i> based on the <a href='permacomputing.html'>universal virtual
machine</a> strategy for digital preservation of software projects and
documentation for <a href='hundred_rabbits.html'>Hundred Rabbits</a>. The
content of the devlog was presented as a talk at Handmade Seattle 2022, watch
the full presentation: <a
href='https://100r.co/site/weathering_software_winter.html'
target='_blank'>Weathering Software Winter</a>.</p>

<ul>
	<li><b>Part 1</b>: <a href='uxn_devlog.html'>A virtual machine</a></li>
	<li><b>Part 2</b>: <a href='varvara_devlog.html'>A personal computer</a></li>
	<li><b>Part 3</b>: <a href='uxntal_devlog.html'>A programming language</a></li>
</ul>

<h3>Acknowledgments</h3>

<img src='../media/generic/uxn.apu.png' width='240' style='float:right'/>

<p>The realization of this project is largely due to the work of the community,
with special thanks to Andy Alderwick, Sigrid Solveig Haflínudóttir, Andrew
Richards, and everyone else who contributed ideas and shared their knowledge
with me, without which Uxn could not have become what it is now. Nearly a year
after its initial draft, <a
href='https://github.com/hundredrabbits/awesome-uxn' target='_blank'>a lot of
uxn code</a> has been written. In fact, this text has been written in <a
href='left.html'>Left</a>, a text-editor hosted on this strangely personal
computer, and this <a href='about.html'>wiki</a> was also generated by it.</p>

<h2>A virtual machine</h2>

<p>Emulation is the reproduction of the behavior of a computer's physical
circuitry with software. Given that an emulator can translate the actions of
one computer onto an other, the same program could be used on both.
<br/>This is called <i>emulation</i>.</p>

<p>Someone could devise the actions of a fictional computer that is not
necessarily based on existing hardware, write software for this fantastical
computer, implement an emulator for it, and use the same program on
supported systems.
<br/>This is called a <i>virtual machine</i>.</p>

<img src='../media/refs/magiciens.png' alt='Le Matin des magiciens, by Louis Pauwels and Jacques Bergier. 1963' width='200'/>

<p>Over the years, I wrote software over various frameworks for a multitude of
peripherals. The vast majority is now defunct after <a
href='obsolescence.html'>vanishing with the platform</a> they were targetting
or by falling behind on the requirements of their ever-changing toolchains. <a
href='stack.html'>Bitrot</a> is the inability to access digital data because
hardware and software no longer exist to read its format. Perhaps it's just a
matter of time until people build emulators to make these projects usable
again, otherwise these projects were never truly mine, and my learning of these
languages <i>only ever belonged to the platforms</i>.</p>

<article>
	<p>So, why not <a href='ansi_c.html'>C</a>? While terminal utilities can be
made portable, cross-platform audio and graphical development is not.</p>
</article>

<h3>I. An Adequate Number Of Bits</h3>

<p>During my research into portability, I kept thinking about how frictionless
it is to play <a href='famicom.html'>NES</a> games today. Pulling on that
thread led me to projects designed explicitly for virtual machines, such as <a
href='https://fabiensanglard.net/another_world_polygons/'
target='_blank'>Another World</a> which is equally easy to play today due to
its targeting of a portable virtual machine, instead of any ever-changing
physical hardware.</p>

<img src='../media/refs/mos6502.jpg' width="100" style='float:right'/>

<p>For a time, I thought I ought to be building software for the NES to ensure
their survival over the influx of disposable <a href='technology.html'>modern
platforms</a> &mdash; So, <a href='assembly.html'>I did</a>. Unfortunately, most of the
software that I care to write and use require slightly more than an 8-button
controller.</p>

<article>
	<p>So, why not the Commodore 64? While it is of the same era as the NES, not
only is implementing a 6502 emulation a difficult task, implementing a c64
emulator is a monumental project beyond my abilities.</p>
</article>

<img src='../media/refs/hands.png' alt='Saul Steinberg, Untouched by Human Hands' width='350'/>

<h3>II. Tarpits & Houses Of Cards</h3>

<p>If the focus of this experiment is to ensure the <a
href='http://collapseos.org/why.html' target='_blank'>support</a> of a piece of
code by writing emulation software for each new platform, the specifications
should be painless to implement. Let's use the time one would need to write a
passable emulator as a limit in complexity for this system. Could a computer
science student implement a mediocre emulation of the 6502 instructions in an
afternoon? Could that design be simplified, changed in some way to make it more
approachable for would-be implementers?</p>

<img src='../media/refs/bthennota.png' width='100'/>

<p><a href='subleq.html'>Subleq</a> is a <i>One-Instruction</i> architecture, an
emulator for this platform takes at most 15 minutes to write. Perhaps this
could be an interesting target, but what it does away in emulation complexity,
it offloads onto the toolchain needed to make intelligible programs.</p>

<p>So, let us also set a limit to the complexity of the toolchain as to not find
ourselves in a <a href='https://esolangs.org/wiki/Turing_tarpit'
target='_blank'>tarpit</a>. It would be an equally Herculean task to build an
<b>emulator and assembler</b> for a machine with thousands of instructions; or
a single instruction machine building abstract logic from thousands of
primitive parts.</p>

<p>How complex can our virtual machine be if the time shared between the
implementation of the runtime and assembly toolchain cannot exceed a single
weekend. We shall call this definition of a computer that fits on a napkin,
capable of self-hosting in a few hundred lines of its own assembly &mdash;
<b><i>A One-page Computer</i></b>.</p>

<h3>III. Things Betwixt</h3>

<p>A <a href='paper_computer.html'>paper computer</a> was created in the early 1980s, when computer access was not yet widespread, it consists of a piece of paper with 21 lines of code on the left and eight registers on the right. The instruction set of five commands(inc, dec, jmp, isz, stp) is small but <a href='https://en.wikipedia.org/wiki/Turing_completeness' target='_blank'>Turing complete</a>, meaning that it can approximately simulate the computational aspects of any other real-world general-purpose computer, and is therefore enough to represent all mathematical functions.</p>

<img src="../media/refs/computers.png" width="300">

<p>In 1977, a programmer wrote a small virtual machine with <a href='chip8.html'>36 instructions</a>, 16 registers and 4096 bytes of memory. It has no mouse, the screen is barely capable of displaying readable text, its controller is a nightmare. &mdash; But I was able to write an emulator and an assembler for it, in an afternoon.</p>

<img src='../media/refs/ma.png' style='float:right; margin-left:30px; width:100px'/>

<p>There is a type of electronics relevant to emulation that <a href='https://excamera.com/sphinx/fpga-j1.html'>has no chips</a>, no instruction set, but instead the programmer designs the hardware circuit in software. As much fun as it would be to create a design that maps well onto these machines, it would make for a poor emulation on my existing devices as it would use nearly none of the optimizations available on the host computer. </p>

<p>Somewhere along this voyage into finding a suitable host for my programs, I began thinking about <a href='collapse.html'>electronic waste</a>, and I couldn't justify surrounding myself with <a href='salvage_computing.html'>yet more electronics</a>. This dream platform would therefore be designed to be emulated, its complexity would be designed around the complexity of software and not that of hardware.</p>

<h3>IV. Back & Forth</h3>

<p>The balancing act of virtual machine instructions, assembler, emulator and the resulting capabilities of its language revealed the stack machines as ideal systems. </p>

<img src="../media/refs/swap.png" alt="Swap operation by Leo Brodie">

<p><a href='forth.html'>Forth</a> is a programming language that consists simply
of splitting text into a list of words, breaking on whitespace, and to
interpret each word, words are often combinations of other words combined to
create more complex words.</p>

<p>Brackets and parentheses are unnecessary: the program merely performs
calculations in the order that is required, letting the automatic stack store
intermediate results on the fly for later use. Likewise, there is no
requirement for precedence rules.</p>

<pre>
<b>LIT</b> a b c [PC]
<b>JCI</b> a b (c8){PC+=[PC]}
<b>JMI</b> a b c {PC+=[PC]}
<b>JSI</b> a b c | PC {PC+=[PC]}

<b>BRK</b> a b c      <b>EQU</b> a b==c             <b>LDZ</b> a b [c8]       <b>ADD</b> a b+c
<b>INC</b> a b c+1    <b>NEQ</b> a b!=c             <b>STZ</b> a {[c8]=b}     <b>SUB</b> a b-c
<b>POP</b> a b        <b>GTH</b> a b&gt;c              <b>LDR</b> a b [PC+c8]    <b>MUL</b> a b*c
<b>NIP</b> a c        <b>LTH</b> a b&lt;c              <b>STR</b> a {[PC+c8]=b}  <b>DIV</b> a b/c
<b>SWP</b> a c b      <b>JMP</b> a b {PC+=c}        <b>LDA</b> a b [c16]      <b>AND</b> a b&c
<b>ROT</b> b c a      <b>JCN</b> a (b8){PC+=c}      <b>STA</b> a {[c16]=b}    <b>ORA</b> a b|c
<b>DUP</b> a b c c    <b>JSR</b> a b | PC {PC+=c}   <b>DEI</b> a b [D+c8]     <b>EOR</b> a b^c
<b>OVR</b> a b c b    <b>STH</b> a b | c            <b>DEO</b> a {[D+c8]=b}   <b>SFT</b> a b&gt;&gt;c8l&lt;&lt;c8h
</pre>

<p>In Forth, memory is made of blocks of cells, which are typically <a
href='binary.html'>16-bits in length</a>, meaning that each piece of data is a
number from 0 to 65535. For this specific imaginary system, I wanted the memory
to consist of cells of 8-bit, or numbers from 0 to 255. For example, the
<code>12 / (34 - 12)</code> sequence is equivalent to the 6 bytes:</p>

<pre>
uxntal |  #  12  34 OVR SUB DIV
binary | a0  12  34  07  19  1b
</pre>

<p>The result is an expressive and extendable virtual machine that can be
implemented in an afternoon exposing a user programmable assembly running at a
reasonable speed. Using stack-machine operations as primitives, along with a
handful of arithmetic and bitwise functions, we find the resulting <a
href='uxn.html'>virtual machine</a> and <a href='uxntal_reference.html'>32
opcodes</a>.</p>

<p>Uxn cannot error and has no <a
href='https://git.sr.ht/~rabbits/uxn-utils/tree/main/item/cli/opctest/opctest.tal'
target='_blank'>unspecified behaviors</a> or edge cases. Its documentation encourages re-implementation instead
of the adoption of a specific implementation. It operates on bytes as to remain portable
on small systems, abstracting I/O entirely to the host system via dedicated opcodes.</p> 


<h2>A personal computer</h2>

<p>What are computers for, anyway?</p>

<p>I think of a computer as a lens through which I can observe and listen to the
natural world. Some mathematicians are of the opinion that the doing of
mathematics is closer to discovery than invention. Mathematical beauty is the
aesthetic pleasure derived from the abstractness, or orderliness of
mathematics. Similarly to how one might enjoy spending time studying venation
patterns, we can imagine a device to explore procedural music and parametric
illustration.</p>

<img src='../media/refs/de_pictura.png' alt='De Pictura, Leon Battista Alberti. 1963' width='400'/>

<p>This romantic vision of the <a href='anarchy.html'>luddite</a>, potentially
emancipating, power of computing was promptly smothered by military drones,
surveillance hardware and the advertisement machinery. Suffice to say, that
nowadays, to most of my friends, computing evokes either encroaching social
networks or the drudgery of data entry.</p>

<img src='../media/refs/hello.png' alt='Hello, on Macintosh.' width='100'/>

<p>Perhaps I'm making it more difficult than necessary by using the term
<i>personal computer</i>, and not finding a more apt word to describe what I
have in mind. This devlog is a summary of notes on the creation of a personal
computer built upon the virtual machine documented in the <a
href='uxn_devlog.html'>previous post</a>.</p>

<h3>I. Personal</h3>

<p>Let's consider the whole enterprise of designing and documenting this
fictional computer to be a sort of <i>model</i> that others could adapt to
their own <a href='marvelous_pursuit.html'>designs</a>, a call to encourage
individuals to conjure up <b>their own vision of a computing machine</b>,
tailored to suit their own needs; And Uxn, a demonstration of the potential of
personal computing systems, and not as a platform that should be adopted and
adapted to fit broader computing needs.</p>

<p>The purpose of this document is not to gather would be users, but instead
review potential portable computing skills that are not platform-specific, and
to serve as a reminder that the key to permaculture's resilience is achieved
through a diversification of methods.</p>

<img src='../media/refs/house.png' width='400'/>

<p>I am certain that making something unique by way of customization is
necessary for care, <i>for when the unique breaks, </i><a
href='https://simonsarris.substack.com/p/that-which-is-unique-breaks'
target='_blank'>we might mend</a>. I often think back on how, in the movie
Hackers(1995), each character had their own laptop launch sequence reflecting
their aesthetics. &mdash; A far cry from today's <a
href='commodity.html'>disposable laptops</a>, each equally adorned of
<i>proprietary services</i> stickers.</p>

<p>For mending to even be envisaged, one must be able to generally understand
that which needs to be mended; a venture which, thanks to the ever
complexifying <a href='stack.html'>stack</a> upon which modern computing is
built, will have you promptly laughed out of the room. But just for the sake of
our talking about virtual machines, our required understanding of the system
shall end at its bytecode.</p>

<img src='../media/generic/varvara.chill.png' width="200" />

<p>A side-effect of working from within unique computing environments is that
looking for generic solutions is often more impractical than solving the
problem head on. By that, I mean by that the solution needs to be adapted to
the specifics of the virtual system, and this in turn develops understanding
and care.</p>

<h3>II. Computer</h3>

<p>Our definition of a computer is the sum of potential I/O communications with
the underlying virtual machine. In this case, the VM can communicate with up to
16 devices at once, but has no knowledge of what a screen or a keyboard might
be, these devices are what make up the <i>computer</i>.</p>

<q>Uxn is to Varvara, what the 6502 is to the Classic Nintendo.</q>

<p>When it came time to find out how I might want to interact with this
computer, I started with a terminal, it seemed as good a place as any to start
off from, by terminal I mean a console to send and receive bytes of data. The
terminal communication allows me to leverage the power of the host OS to
further develop the system.</p>

<img src='../media/generic/uxn.devices.png' width='350'/>

<p>As the system begins to take shape, I consider that possibly someday I may
lose my sight, or the use of my hands, or I may become deaf. I wonder how I
might replace one device for another in the future, and how I might adapt each
device to my changing needs. I leave some blank spaces to be filled at a later
time, should I need them.</p>

<h2>A programming language</h2>

<p>It is fair to assume that programming with so few primitives, will make it
difficult for compilers, and related tooling, to infer meaning from a program's
source files. But we can still convey a lot of details about the intent of
various data structures by encoding information in the few tools at our
disposal.</p>

<h3>I. Structural Editing</h3>

<p>Let's consider the following uxn program, and associated symbols file,
created with <a href='drifblim.html'>Drifblim</a>:</p>

<pre>
<i>hello.rom</i>

a001 1560 0001 0040 0005 9480 1817 2194
20ff f722 6c48 656c 6c6f 2057 6f72 6c64
21

<i>hello.rom.sym</i>

0018 write           0100 ( -> )
0100 on-reset        0107 ( str* -: )
0107 &lt;print&gt;         010a ( -- )
010a &lt;print&gt;/while   010a ( send )
010f &lt;print&gt;/        010e ( loop )
0115 hello-txt
</pre>

<p>It is possible to <a href='https://git.sr.ht/~rabbits/uxnrea'
target='_blank'>recreate</a> a textual source file by walking through the
program data, drawing from the symbols file, as: first the labels, second the
sublabels, lastly the comments, and create the following valid program:</p>

<pre>
|0018 @write |0100 @on-reset ( -> ) ;hello-txt &lt;print&gt; BRK @&lt;print&gt; ( str* -: ) !& &while ( -- ) ( send ) LDAk .write DEO ( loop ) INC2 & LDAk ?&while POP2 JMP2r @hello-txt 48 65 6c 6c 6f 20 57 6f 72 6c 64 
</pre>

<p>While this text stream can be reassembled into the program from which it
originates, it will first need to be <a
href='uxnfor.html'>reformatted</a> to be
readable as a programming artifact.</p>

<pre>
|0018 
@write 
|0100 
@on-reset ( -> )
	;hello-txt &lt;print&gt; BRK
@&lt;print&gt; ( str* -: )
	!& &while ( -- )
		( send ) LDAk .write DEO
		( loop ) INC2 & LDAk ?&while POP2 JMP2r
@hello-txt 
	48 65 6c 6c 6f 20 57 6f 72 6c 64
</pre>

<p>By breaking on absolute padding, label tokens, non-defining comments, and
tabbing the content of sublabels, we can improve readability further and can
already return to something like what the original source file might have
looked like:</p>

<pre>
|0018 

@write

|0100 

@on-reset ( -> )
	;hello-txt &lt;print&gt;
	BRK

@&lt;print&gt; ( str* -: )
	!&
	&while ( -- )
		( send ) LDAk .write DEO
		( loop ) INC2 & LDAk ?&while
	POP2 JMP2r

@hello-txt
	"Hello 20 "World! 00
</pre>

<p>Finally, we can ensure that lines terminate on emiting
opcodes(STZ/STR/STA/DEO) and some immediate opcodes(JCI, JMI). To make explicit
that some routines are emiting, and therefore line-terminating, I chose to use
the <code>&lt;label&gt;</code> format</code>.</p>

<img src='../media/generic/potato.png' width='100' style='float:right; margin-left: 30px'/>

<p>Labels marking the start of binary information use prefixes that communicate
to the reassembler, how to handle the content. For example, <i>txt</i> for
ascii characters, <i>icn</i> for 1-bit graphics and <i>chr</i> for 2-bit
graphics.</p>

<h3>II. Source Validation</h3>

<p>Lacking data types, there is not much to go on as far as static validation,
but there is still <a href='https://git.sr.ht/~rabbits/uxnrea'
target='_blank'>space</a> to explore here. Type inference in Uxntal is done by
checking the stack effect declarations of words, against the sum of stack
changes predicted to occur based on the arity of each token in their
bodies.</p>

<pre>
@add ( a* b* -: c* ) <i>Warning: Imbalance in @add of +2</i>
	DUP2 ADD2 <b>JMP2r</b>
</pre>

<p>Words that do not pass the stack-checker are generating a warning, and so
essentially this defines a very basic and permissive type system that
nevertheless catches some invalid programs and enables compiler optimizations.
</p>

<pre>
@routine ( a b -: c ) <i>Warning: Imbalance in @routine of +1</i>
	EQUk <b>?&sub-routine</b>
	POP2 #0a JMP2r
	&sub-routine ( a b -: c*</b> )
		POP2 #000b JMP2r
</pre>

<h3>III. Graph Reduction</h3>

<p>Routines are sequences of combinators that ingest values from the stacks,
some permutations of these combinators are obviously redundant and <a
href='uxnlin.html'>reducing</a> these
extraneous transformations can be done on source files, for example: </p>

<pre>
#12 #34 <b>SWP POP</b> -> #1234 NIP 
</pre>

<p>Tail-call optimization can be understood as a form of graph reduction, where
jumps to subroutines followed by subroutine returns can be replaced instead by
a single jump. </p>

<pre>
@routine ( a b -: c )
	SWP ;function <b>JSR2 JMP2r</b> -> SWP ;function JMP2
</pre>

<p>Going one step further, routines that would otherwise terminate in a
tail-call optimisation could even be relocated before their tail's location in
memory and do away with the ending jump altogether. Incidentally, we see here a
comment marker to indicate to the stack-effect checker that the routine's tail
will fall-through.</p>

<pre>
@routine ( a b -: c )
	SWP <b>;function JMP2</b> -> SWP ( >> )

@function ( a b -: c )
	ADD JMP2r
</pre>

<p>I feel like I've only just begun to scratch the surface of what can be done
with the language, and will update this document as new things are
uncovered.</p>

<img src='../media/generic/varvara.potato.png' width='200'/>

<p>The previous notes contain experiments done with <a
href='uxntal_software.html'>self-hosted tools</a>, from the assembly,
formatting, to the validation &mdash; each tool is written it the language that
it assembles, formats or validates. Each program follows the same pattern of
ingesting a file path, emitting errors and warnings through the Console/error
port, and emits the same file path through Console/write on success, making
them composable.</p>

<ul></ul><p class="incoming"><b>incoming</b> <a href="uxn.html">uxn</a> </p></main>
<footer><a href="https://creativecommons.org/licenses/by-nc-sa/4.0" target="_blank"><img src="../media/icon/cc.svg" alt="CreativeCommons"/></a><a href="https://webring.xxiivv.com/" target="_blank"><img src="../media/icon/webring.svg" alt="Webring"/></a><a href="https://merveilles.town/@neauoire" rel="me" target="_blank"><img src="../media/icon/merveilles.svg" alt="Merveilles"/></a><a href="ethics.html"><img src="../media/icon/dreipfeile.svg" alt="NoNazis!"/></a><a href="uxn.html"><img src="../media/icon/uxn.svg" alt="UxnPowered"/></a><span><a href="devine_lu_linvega.html">Devine Lu Linvega</a> &copy; 2023 &mdash; <a href="about.html#license">BY-NC-SA 4.0</a></span></footer>
</body></html>