<!DOCTYPE html><html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../links/main.css" type="text/css" rel="stylesheet"><link href="../media/services/icon.png" type="image/png" rel="shortcut icon">
<title>XXIIVV &mdash; matrioshka</title></head><body>
<header><a href="home.html"><img alt="XXIIVV" src="../media/icon/logo.svg"></a></header>

<nav><ul><li><a href="programming_languages.html" class="parent">programming languages</a></li><li><a href="operating_systems.html">operating systems</a></li><li><a href="graphical_input.html">graphical input</a></li><li><a href="file_formats.html">file formats</a></li><li><a href="data_encoding.html">data encoding</a></li><li><a href="type_systems.html">type systems</a></li><li><a href="versioning.html">versioning</a></li></ul><ul><li><a href="assembly.html">assembly</a></li><li><a href="concatenative.html">concatenative</a></li><li><a href="applicative.html">applicative</a></li><li><a href="flow-based.html">flow-based</a></li><li><a href="imperative.html">imperative</a></li><li><a href="matrioshka.html" class="self">matrioshka</a></li><li><a href="esoteric.html">esoteric</a></li></ul><ul><li><a href="thue.html">thue</a></li><li><a href="modal.html">modal</a></li></ul></nav>
<main><h2>Matrioshka languages have multiple, distinct phases with different syntactic and semantic rules. </h2>

<p>There are often two phases; the first gives a set of rules, and the second provides objects on which those rules are to be applied.</p>
<h2>Thue is a matrioshka esoteric computer based on string rewriting rules.</h2>

<p>A Thue program consists of two parts: a list of <a
href='logic.html'>substitution rules</a>, which is terminated with a line
having both sides of the operator empty, followed by a string representing the
initial program state.</p>

<pre>
#::=<span style='color:#777'>Unused rules are comments</span>
a::=~Hello Thue!
::=
[a] <span style='color:#777; float:right'>[]</span>
</pre>

<p>Execution consists of picking, from the list of rules, an arbitrary rule whose original string exists as a substring somewhere in the program state, and replacing that substring by the rule's replacement string. This process repeats until there are no rules that can be applied, at which point, the program ends. </p>

<pre>
#::=<span style='color:#777'>Increment binary number</span>
1_::=1++
0_::=1
01++::=10
11++::=1++0
_0::=_
_1++::=10
::=
_10010011_ <span style='color:#777; float:right'>_10010100</span>
</pre>

<p>Thue represents one of the simplest possible constraint-based programming
language. It is to the constraint-based paradigm what languages like OISC are
to the imperative paradigm. </p>

<img src='../media/refs/bthennota.png' width='100'/>

<h3>Input</h3>

<p>Added to this simple system are two strings which are used to permit Thue to communicate with the outside world. The first of these is the input symbol (":::").  The input symbol is actually the lhs of an implicit rule of which the user (or system's "input stream") is a component.  The input symbol, therefore, is replaced by a line of text received from the "input stream."</p>

<h3>Output</h3>

<p>As a counterpart of input, the output symbol ("~") is supplied.  Like the input symbol, the output symbol triggers an implicit rule which, in this case, encompasses the "output stream."  The specific effect is that all text to the right of the output symbol in the rhs of a production is sent to the output stream.</p>

<p>Note that either (or both) of these implicit rules may be overridden by providing explicit rules that perform some other task.</p>

<pre>
#::=<span style='color:#777'>Sierpinski's triangle, backticks are linebreaks</span>
X::=~_
Y::=~*
Z::=~`
_.::=._X
_*::=*_Y
._|::=.Z-|
*_|::=Z
..-::=.-.
**-::=*-.
*.-::=*-*
.*-::=.-*
@.-::=@_.
@*-::=@_*
::=
@_*...............................|
</pre>

<q>It is pitch black. You are likely to be eaten by a Thue.</q>

<ul>
	<li><a href='https://esolangs.org/wiki/Thue' target='_blank'>On Esolangs</a></li>
	<li><a href='https://git.sr.ht/~rabbits/thuesday' target='_blank'>Interpreter</a>, written in Uxntal. <a href='https://www.youtube.com/watch?v=A8f7IsQ8ENQ' target='_blank'>Video</a></li>
	<li><a href='https://git.catseye.tc/Wanda/' target='_blank'>Wanda</a>, concatenative language meets string rewriting.</li>
</ul>
<h2>Modal is a matrioshka language based on pattern-matching to rewrite trees.</h2>

<img src='../media/refs/soulages2.jpg' style='float:right;width:200px' title='Pierre Soulages | Lithographie nÂ°30 (1972)'/>

<p>Modal programs are represented as a series of rules, formatted as tokens delimited by brackets and parentheses, applied to a given tree which gets continually modified until no rules match any given part of the tree. </p>

<q><b>modal</b>(adj.): <br/>&nbsp;&nbsp;&nbsp;&nbsp;of, or relating to structure as opposed to substance.</q>

<p>Rules are made of:</p>

<ul>
	<li><a href='#tokens'>Tokens</a>: foo, bar</li>
	<li><a href='#registers'>Registers</a>: ?foo, ?bar</li>
	<li><a href='#sequences'>Sequences</a>: (foo ?bar (baz)), foo (bar (baz))</li>         
</ul>

<h3 id='tokens'>Tokens</h3>

<p>To define a rule, we start a line with <kbd>&lt;&gt;</kbd>, followed by a <i>left</i> and <i>right</i> sequence:</p>

<pre><b>&lt;&gt;</b> hello bye

.. hello world
00 bye world</pre>

<h3 id='registers'>Registers</h3>

<p>Registers can hold an address in a pattern and be used in rules during rewriting:</p>

<pre><b>&lt;&gt;</b> (copy ?a) (?a ?a)

.. copy cat
00 cat cat</pre>

<p>When a register is used in a pattern, and when we try
to match a given tree with a pattern, each register is bound to a
corresponding an address and referenced in either side of a rule:</p>

<pre><b>&lt;&gt;</b> (swap ?x ?y) (?y ?x)

.. (swap fox rat)
00 (rat fox)</pre>

<p>A register cannot be reassigned during rewriting, it is treated as an equality check:</p>

<pre><b>&lt;&gt;</b> (?x ?x) same

.. (fox fox)
00 (same)
</pre>

<h3 id='sequences'>Sequences</h3>

<p>This allow programs to mimic other programming languages. Any choice made in regard to syntax beyond this point is completely arbitrary. To demonstrate, the following code defines a concatenative syntax:</p>

<pre>
<b>&lt;&gt;</b> (?x dup) (?x ?x)
<b>&lt;&gt;</b> (?x ?y swap) (?y ?x)
<b>&lt;&gt;</b> ( ?x pop) ()

.. (1 2 3) (4 5 6) swap pop dup
01 (4 5 6) (1 2 3) pop dup
02 (4 5 6) dup
00 (4 5 6) (4 5 6)
</pre>

<!--
<p>To generate a list of numbers counting down from 10 to zero, in the prefix notation, we can define these three rules:</p>

<pre>
<b>&lt;&gt;</b> (0 range) {0}
<b>&lt;&gt;</b> (?n range) {?n ?n - 1 range}
<b>&lt;&gt;</b> (range ?n) {?n range}

::> (10 range)
(10 9 8 7 6 5 4 3 2 1 0)
</pre>

<p>Recursion in string-rewriting, is emulated with multiple rules:</p>

<pre>
<b>&lt;&gt;</b> (factorial (1)) (1)
<b>&lt;&gt;</b> (factorial (?n)) (?n * (factorial (?n - 1)))

::> factorial (5)
120</pre>

-->
<h3>Logic</h3>

<p>Let us build a logic system, starting by comparing two registers:</p>

<pre>
<b>&lt;&gt;</b> (eq ?x ?x) (#t)
<b>&lt;&gt;</b> (eq ?x ?y) (#f)

.. (eq fox bat)
01 (#f)
</pre>

<p>We can implement the truth tables by defining each case:</p>

<pre>
<b>&lt;&gt;</b> (and (#t) (#t)) (#t)
<b>&lt;&gt;</b> (and (#t) (#f)) (#f)
<b>&lt;&gt;</b> (and (#f) (#t)) (#f)
<b>&lt;&gt;</b> (and (#f) (#f)) (#f)
<b>&lt;&gt;</b> (or (#t) (#t)) (#t)
<b>&lt;&gt;</b> (or (#t) (#f)) (#t)
<b>&lt;&gt;</b> (or (#f) (#t)) (#t)
<b>&lt;&gt;</b> (or (#f) (#f)) (#t)
<b>&lt;&gt;</b> (not (#t)) (#f)
<b>&lt;&gt;</b> (not (#f)) (#t)

.. (or (eq cat bat) (eq fox fox))
11 (or (#f) (eq fox fox))
10 (or (#f) (#t))
06 (#t)
</pre>

<p>Building on the comparison rule above, we can write conditionals: </p>
<pre>
<b>&lt;&gt;</b> (if (#t) ?b) (?b)
<b>&lt;&gt;</b> (if (#f) ?b) ()

.. (if (eq bat bat) reached!)
02 (if (#t) reached!)
00 (reached!)
</pre>

<p>Going further, we can create a rule that expects a ternary statement: </p>
<pre>
<b>&lt;&gt;</b> (ifelse (#t) ?t ?f) (?t)
<b>&lt;&gt;</b> (ifelse (#f) ?t ?f) (?f)

.. (ifelse (eq cat fox) on-equal on-unequal)
03 (ifelse (#f) on-equal on-unequal)
01 (on-unequal)
</pre>

<h3 id='arithmetic'>Arithmetic</h3>

<p>The language does not accomodate for any specific numerical system, but allows for the notion of numbers to be implemented with Church Numerals:</p>

<pre>
<b>&lt;&gt;</b> (add (s ?x) (s ?y)) (s (add ?x (s ?y)))
<b>&lt;&gt;</b> (add (s ?x) (0)) (s ?x)
<b>&lt;&gt;</b> (add (0) (s ?y)) (s ?y)
<b>&lt;&gt;</b> (add (0) (0)) (0)
<b>&lt;&gt;</b> (sub (s ?x) (s ?y)) (sub ?x ?y)
<b>&lt;&gt;</b> (sub (s ?x) (0)) (s ?x)
<b>&lt;&gt;</b> (sub (0) (s ?y)) (s ?y)
<b>&lt;&gt;</b> (sub (0) (0)) (0)
<b>&lt;&gt;</b> (mul (s ?x) (s ?y)) (add (s ?x) (mul (s ?x) (sub (s ?y) (s (0)))))
<b>&lt;&gt;</b> (mul (s ?x) (s (0))) (s ?x)
<b>&lt;&gt;</b> (mul (s (0)) (s ?y)) (s ?y)
<b>&lt;&gt;</b> (mul (s ?x) (0)) (0)
<b>&lt;&gt;</b> (mul (0) (s ?x)) (0)
</pre>

<p>To convert from prefix notation to infix: </p>
<pre>
<b>&lt;&gt;</b> (?x + ?y) (add ?x ?y)
<b>&lt;&gt;</b> (?x - ?y) (sub ?x ?y)
<b>&lt;&gt;</b> (?x * ?y) (mul ?x ?y)
</pre>

<p>Altogether, we have enough parts to implement factorial: </p>
<pre>
<b>&lt;&gt;</b> (factorial (s (0))) ((s (0)))
<b>&lt;&gt;</b> (factorial (s ?x)) (((s ?x) * factorial ((s ?x) - (s (0)))))

factorial (s (s (s (s (s (0))))))
</pre>

<h3 id='types'>Type Systems</h3>

<p>Creating a type system is merely a matter of creating stricter rules expecting a specific grammar, for example: </p>

<pre>
<b>&lt;&gt;</b> (join (String ?x) (String ?y)) (?x ?y)

.. (join (String hello) (String world)) (join foo bar)
00 (hello world) (join foo bar)
</pre>

<h3>Mimics</h3>

<p>We can use rules to define entire languages, for example, we saw above how this can specify a <a href='concatenative.html'>concatenative</a> language with a postfix syntax. Modal enforces no specific notation, for example, we could easily make a <a href='lisp.html'>lisp</a> or <a href='logic.html'>combinatory logic</a>:</p>

<pre>
<b>&lt;&gt;</b> (M ?x) (?x ?x)
<b>&lt;&gt;</b> (KI ?x ?y) (?y)
<b>&lt;&gt;</b> (T ?x ?y) (?y ?y)
<b>&lt;&gt;</b> (W ?x ?y) (?x ?y ?y)
<b>&lt;&gt;</b> (K ?x ?y) (?x)
<b>&lt;&gt;</b> (C ?x ?y ?z) (?x ?z ?y)
<b>&lt;&gt;</b> (B ?x ?y ?z) (?x (?y ?z))
<b>&lt;&gt;</b> (I ?x) (?x)
<b>&lt;&gt;</b> (S ?x ?y ?z) (?x ?z (?y ?z))

.. C KI x y z
05 KI y x z
01 x z
</pre>

<h3>Implementation</h3>

<p>The entire Modal runtime can be implemented in a mere 200 lines of <a href='ansi_c.html'>ANSI C</a>.</p>

<div class='codeview'>
	<iframe src='../etc/modal.c.txt'></iframe>
	<pre>cc modal.c -o modal <a href='../etc/modal.c.txt' target='_blank'>view raw</a></pre>
</div>

<ul>
	<li><a href='https://git.sr.ht/~rabbits/modal' target='_blank'>view sources</a>, ANSI C.</li>
	<li><a href='https://discord.gg/9e7vaVTSVs' target='_blank'>discord channel</a>, in the concatenative server.</li>
	<li>Original creation of <a href='https://wryl.tech/' target='_blank'>wryl</a>, many of the code above is their own work and merely made available here as to give this fantastic system a home on the internet.</li>
</ul>

<style>
	div.codeview { background:#eee; border:2px solid black; border-radius:4px }
	div.codeview iframe { height:405px; border:0; margin:0; display:block }
	div.codeview pre { margin:0; background:#000; color:#fff }
	div.codeview pre a { float:right; color:#72dec2; text-decoration:none }
</style><ul></ul></main>
<footer><a href="https://creativecommons.org/licenses/by-nc-sa/4.0" target="_blank"><img src="../media/icon/cc.svg" alt="CreativeCommons"/></a><a href="https://webring.xxiivv.com/" target="_blank"><img src="../media/icon/webring.svg" alt="Webring"/></a><a href="https://merveilles.town/@neauoire" rel="me" target="_blank"><img src="../media/icon/merveilles.svg" alt="Merveilles"/></a><a href="ethics.html"><img src="../media/icon/dreipfeile.svg" alt="NoNazis!"/></a><a href="uxn.html"><img src="../media/icon/uxn.svg" alt="UxnPowered"/></a><span><a href="devine_lu_linvega.html">Devine Lu Linvega</a> &copy; 2023 &mdash; <a href="about.html#license">BY-NC-SA 4.0</a></span></footer>
</body></html>