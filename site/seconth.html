<!DOCTYPE html><html><head><link href="../links/main.css" type="text/css" rel="stylesheet"/><link href="../media/services/icon.png" type="image/png" rel="shortcut icon"/><title>XXIIVV &mdash; seconth</title></head><body><header><a href="home.html"><img src="../media/icon/logo.svg" alt="XXIIVV"/></a></header><nav><ul><li><a href="../site/roms.html">roms</a></li><li><a href="../site/tools.html">tools</a></li><li><a href="../site/utilities.html">utilities</a></li><li><a href="../site/formats.html">formats</a></li><li><a href="../site/games.html">games</a></li><li><a href="../site/toys.html">toys</a></li><li><a href="../site/mobile.html">mobile</a></li><li><a href="../site/unreleased.html">unreleased</a></li></ul><ul><li><a href="../site/firth.html">firth</a></li><li><a href="../site/shim.html">shim</a></li><li>seconth/</li><li><a href="../site/stopwatch.html">stopwatch</a></li></ul><ul></ul></nav><main><h2>Seconth, or 2th, is a plain-text calendar with events.</h2>

<p>Second is a calendar utility created to overlay events on pages of the gregorian calendar, written in <a href='ansi_c.html'>ANSI C</a>.</p>
<h3>Event Format</h3>
<p>The events are stored in text files in the format: </p>
<pre>20201126 Sailing trip to Port Townsend</pre>
<h3>2th.c</h3>
<pre>#include &lt;stdio.h&gt;<br />#include &lt;time.h&gt;<br /><br />/* <br />Copyright (c) 2020 Devine Lu Linvega<br /><br />Permission to use, copy, modify, and distribute this software for any<br />purpose with or without fee is hereby granted, provided that the above<br />copyright notice and this permission notice appear in all copies.<br /><br />THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES<br />WITH REGARD TO THIS SOFTWARE.<br />*/<br /><br />#define EVENTMAX 1024<br /><br />typedef struct Event {<br />	int y, m, d;<br />	char name[256];<br />} Event;<br /><br />typedef struct Calendar {<br />	int y, m, d, len;<br />	Event events[EVENTMAX];<br />} Calendar;<br /><br />char *months[] = {"Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"};<br /><br />int<br />slen(char *s)<br />{<br />	int i = 0;<br />	while(s[++i])<br />		;<br />	return i;<br />}<br /><br />int<br />sint(char *s, int len)<br />{<br />	int n = 0, i = 0;<br />	while(i &lt; len &amp;&amp; s[i] &amp;&amp; s[i] &gt;= '0' &amp;&amp; s[i] &lt;= '9') {<br />		n = n * 10 + (s[i] - '0');<br />		i++;<br />	}<br />	return n;<br />}<br /><br />char *<br />scpy(char *src, char *dst, int len)<br />{<br />	int i = 0;<br />	while(i &lt; len - 1 &amp;&amp; (dst[i] = src[i]))<br />		i++;<br />	return dst;<br />}<br /><br />int<br />daysmonth(int y, int m)<br />{<br />	if(m == 1 || m == 3 || m == 5 || m == 7 || m == 8 || m == 10 || m == 12)<br />		return 31;<br />	else if((m == 2) &amp;&amp; ((y % 400 == 0) || (y % 4 == 0 &amp;&amp; y % 100 != 0)))<br />		return 29;<br />	else if(m == 2)<br />		return 28;<br />	else<br />		return 30;<br />	return 0;<br />}<br /><br />int<br />dayweek(int y, int m, int d)<br />{<br />	int t[] = {0, 3, 2, 5, 0, 3, 5, 1, 4, 6, 2, 4};<br />	y -= m &lt; 3;<br />	return (y + y / 4 - y / 100 + y / 400 + t[m - 1] + d) % 7;<br />}<br /><br />void<br />setevent(Calendar *c, int y, int m, int d, char *name)<br />{<br />	Event *e = &amp;c-&gt;events[c-&gt;len++];<br />	scpy(name, e-&gt;name, slen(name));<br />	e-&gt;y = y;<br />	e-&gt;m = m;<br />	e-&gt;d = d;<br />}<br /><br />Event *<br />getevent(Calendar *c, int y, int m, int d)<br />{<br />	int i;<br />	for(i = 0; i &lt; c-&gt;len; i++) {<br />		Event *e = &amp;c-&gt;events[i];<br />		if(e-&gt;y == y &amp;&amp; e-&gt;m == m &amp;&amp; e-&gt;d == d)<br />			return e;<br />	}<br />	return NULL;<br />}<br /><br />void<br />printevents(Calendar *c, int y, int m, int d)<br />{<br />	int i, l = c-&gt;m;<br />	for(i = 0; i &lt; 90; i++) {<br />		Event *e = getevent(c, y, m, d);<br />		if(e) {<br />			if(l != m)<br />				puts("");<br />			if(i == 0)<br />				printf(" Today        ");<br />			else if(i == 1)<br />				printf(" Tomorrow     ");<br />			else<br />				printf(" In %02d days   ", i);<br />			puts(e-&gt;name);<br />			l = m;<br />		}<br />		d++;<br />		if(d &gt; daysmonth(y, m)) {<br />			d = 1;<br />			m++;<br />			if(m &gt; 12) {<br />				m = 1;<br />				y++;<br />			}<br />		}<br />	}<br />	puts("");<br />}<br /><br />void<br />printcalendar(Calendar *c)<br />{<br />	int i;<br />	int dw = dayweek(c-&gt;y, c-&gt;m, 1);<br />	int dm = daysmonth(c-&gt;y, c-&gt;m);<br />	printf(" %s %d\n", months[c-&gt;m - 1], c-&gt;y);<br />	printf(" Su  Mo  Tu  We  Th  Fr  Sa ");<br />	for(i = 0; i &lt;= 35; i++) {<br />		int d = i - dw + 1;<br />		if(i % 7 == 0)<br />			puts("");<br />		if(d == c-&gt;d)<br />			printf("&lt;%2d&gt;", d);<br />		else if(getevent(c, c-&gt;y, c-&gt;m, d))<br />			printf("[%2d]", d);<br />		else if(d &gt; 0 &amp;&amp; d &lt;= dm)<br />			printf(" %2d ", d);<br />		else<br />			printf("    ");<br />	}<br />	puts("");<br />}<br /><br />void<br />loadevents(FILE *f, Calendar *c)<br />{<br />	char line[256];<br />	if(!f)<br />		return;<br />	while(fgets(line, 256, f)) {<br />		if(line[0] == ';' || slen(line) &lt; 12)<br />			continue;<br />		if(c-&gt;len &gt;= EVENTMAX)<br />			break;<br />		setevent(c,<br />			line[0] == '*' ? c-&gt;y : sint(line, 4),<br />			line[5] == '*' ? c-&gt;m : sint(line + 4, 2),<br />			line[7] == '*' ? c-&gt;d : sint(line + 6, 2),<br />			line + 9);<br />	}<br />	fclose(f);<br />}<br /><br />void<br />init(Calendar *cal)<br />{<br />	time_t t;<br />	struct tm *local;<br />	time(&amp;t);<br />	local = localtime(&amp;t);<br />	cal-&gt;y = local-&gt;tm_year + 1900;<br />	cal-&gt;m = local-&gt;tm_mon + 1;<br />	cal-&gt;d = local-&gt;tm_mday;<br />}<br /><br />int<br />main(int argc, char *argv[])<br />{<br />	Calendar cal;<br />	init(&amp;cal);<br />	loadevents(fopen(argc &gt; 1 ? argv[1] : "calendar", "r"), &amp;cal);<br />	printcalendar(&amp;cal);<br />	printevents(&amp;cal, cal.y, cal.m, cal.d);<br />	return 0;<br />}<br /></pre>

<ul></ul></main><footer><a href="https://creativecommons.org/licenses/by-nc-sa/4.0" target="_blank"><img src="../media/icon/cc.svg" alt="CreativeCommons"/></a><a href="http://webring.xxiivv.com/" target="_blank"><img src="../media/icon/webring.svg" alt="Webring"/></a><a href="https://merveilles.town/@neauoire" target="_blank"><img src="../media/icon/merveilles.svg" alt="Merveilles"/></a><a href="uxn.html"><img src="../media/icon/uxn.svg" alt="Uxn Powered"/></a><span><a href="devine_lu_linvega.html">Devine Lu Linvega</a> &copy; 2021 &mdash; <a href="about.html">BY-NC-SA 4.0</a></span></footer></body></html>