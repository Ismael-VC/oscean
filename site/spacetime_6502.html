<!DOCTYPE html><html><head><link href="../links/main.css" type="text/css" rel="stylesheet"/><link href="../media/services/icon.png" type="image/png" rel="shortcut icon"/><title>XXIIVV &mdash; spacetime 6502</title></head><body><header><a href="home.html"><img src="../media/icon/logo.svg" alt="XXIIVV"/></a></header><nav><ul><li><a href="../site/roms.html">roms</a></li><li><a href="../site/tools.html">tools</a></li><li><a href="../site/utilities.html">utilities</a></li><li><a href="../site/formats.html">formats</a></li><li><a href="../site/games.html">games</a></li><li><a href="../site/toys.html">toys</a></li><li><a href="../site/mobile.html">mobile</a></li><li><a href="../site/unreleased.html">unreleased</a></li></ul><ul><li><a href="../site/paradise.html">paradise</a></li><li><a href="../site/bifurcan.html">bifurcan</a></li><li>spacetime 6502/</li><li><a href="../site/nespaint.html">nespaint</a></li></ul><ul></ul></nav><main><p>Spacetime is a weird function sequencer.</p>

<p>This is a <a href='famicom.html'>Famicom</a> port of <a href='https://monome.org/docs/norns/study-3/' target='_blank'>Study 3</a> for the <a href='norns.html'>Norns</a>, written in <a href='assembly.html'>6502 assembly</a>.</p>
<p>It plays a note on each step, ach step is a symbol for an action. It has 8 operators, I've added a snare hit to the random note operator for fun, and all operations wrap-around, since it only runs on 4 octaves.</p>
<h3>Source</h3>
<pre>./asm6 cart.asm cart.nes</pre>
<p>The source is written for the <a href='https://wiki.nesdev.com/w/index.php/Tools' target='_blank'>asm6</a> assembler, in the <a href='lin6.html'>Lin6</a> style.</p>
<article><br />;; header<br /><br />	.db "NES", $1a ; identification of the iNES header<br />	.db 1 ; number of 16KB PRG-ROM pages<br />	.db $01 ; number of 8KB CHR-ROM pages<br />	.db $00 ; NROM<br />	.dsb $09,$00 ; clear the remaining bytes<br />	.fillvalue $FF ; Sets all unused space in rom to value $FF<br />	.org $C000<br /><br />;; constants<br /><br />	PPUCTRL                 .equ $2000 <br />	PPUMASK                 .equ $2001 <br />	PPUSTATUS               .equ $2002 <br />	SPRADDR                 .equ $2003 <br />	PPUSCROLL               .equ $2005 <br />	PPUADDR                 .equ $2006 <br />	PPUDATA                 .equ $2007 <br />	APUCH1VOL               .equ $4000 ; APU<br />	APUCH1SWP               .equ $4001 ; APU<br />	APUCH1FRQ               .equ $4002 ; APU<br />	APUCH1LEN               .equ $4003 ; APU<br />	APUCH2VOL               .equ $4004 ; APU<br />	APUCH2SWP               .equ $4005 ; APU<br />	APUCH2FRQ               .equ $4006 ; APU<br />	APUCH2LEN               .equ $4007 ; APU<br />	APUCH3CNT               .equ $4008 ; APU<br />	APUCH3SWP               .equ $4009 ; APU<br />	APUCH3FRQ               .equ $400a ; APU<br />	APUCH3LEN               .equ $400b ; APU<br />	APUCH4VOL               .equ $400c ; APU<br />	APUCH4SWP               .equ $400d ; APU<br />	APUCH4FRQ               .equ $400e ; APU<br />	APUCH4LEN               .equ $400f ; APU<br />	SPRDMA                  .equ $4014 <br />	APUCTRL                 .equ $4015 <br />	JOY1                    .equ $4016 <br />	JOY2                    .equ $4017 <br />	BUTTON_RIGHT            .equ #$01  <br />	BUTTON_LEFT             .equ #$02  <br />	BUTTON_DOWN             .equ #$04  <br />	BUTTON_UP               .equ #$08  <br />	BUTTON_START            .equ #$10  <br />	BUTTON_SELECT           .equ #$20  <br />	BUTTON_B                .equ #$40  <br />	BUTTON_A                .equ #$80  <br /><br />;; variables<br /><br />	.enum $0000<br />	position                .dsb 1<br />	cursor                  .dsb 1<br />	note                    .dsb 1<br />	marker                  .dsb 1<br />	btndown                 .dsb 1<br />	btnlast                 .dsb 1<br />	btnqueue                .dsb 1<br />	rate                    .dsb 1<br />	timer                   .dsb 1<br />	seed                    .dsb 1<br />	.ende <br /><br />;; reset<br /><br />RESET: <br />	SEI                                ; disable IRQs<br />	CLD                                ; disable decimal mode<br />	LDX #$40<br />	STX $4017                          ; disable APU frame IRQ<br />	LDX #$FF<br />	TXS                                ; set up stack<br />	INX                                ; now X = 0<br />	STX PPUCTRL                        ; disable NMI<br />	STX PPUMASK                        ; disable rendering<br />	STX $4010                          ; disable DMC IRQs<br /><br />Vblankwait1: ; First wait for vblank<br />	BIT PPUSTATUS<br />	BPL Vblankwait1<br /><br />Clrmem: <br />	LDA #$00<br />	STA $0000, x<br />	STA $0100, x<br />	STA $0300, x<br />	STA $0400, x<br />	STA $0500, x<br />	STA $0600, x<br />	STA $0700, x<br />	LDA #$FE<br />	STA $0200, x                       ; move sprites off screen<br />	INX <br />	BNE Clrmem<br /><br />Vblankwait2: ; Second wait for vblank<br />	BIT PPUSTATUS<br />	BPL Vblankwait2<br /><br />;; setup phase<br /><br />SetupPalettes: <br />	LDA PPUSTATUS<br />	LDA #$3F<br />	STA PPUADDR<br />	LDA #$00<br />	STA PPUADDR<br />	LDX #$00<br />@loop: <br />	LDA Palettes, x<br />	STA PPUDATA<br />	INX <br />	CPX #$20<br />	BNE @loop<br /><br />SetupAttributes: <br />	LDA PPUSTATUS<br />	LDA #$23<br />	STA PPUADDR<br />	LDA #$C0<br />	STA PPUADDR<br />	LDX #$00<br />@loop: <br />	LDA #$00<br />	STA PPUDATA<br />	INX <br />	CPX #$40<br />	BNE @loop<br /><br />SetupSequence: <br />	LDX #$00<br />@loop: <br />	LDA $00                            ; set entire sequence to "+"<br />	STA $10,x                          ; store on zeropage second row<br />	INX <br />	CPX #$10<br />	BNE @loop<br /><br />SetupVariables: <br />	LDA #$08<br />	STA rate                           ; default rate = 08<br />	LDA #$20<br />	STA note                           ; default note = C<br />	LDA #$05<br />	STA marker<br /><br />SetupAudio: <br />	LDY #$0f                           ; init $4000-4013<br />@loop: <br />	LDA ApuStates,y<br />	STA $4000,y<br />	DEY <br />	BPL @loop<br />	LDA #$0f                           ; skip over $4014 (OAMDMA)<br />	STA $4015<br />	LDA #$40<br />	STA $4017<br /><br />SetupInterface: <br />@cursor: <br />	LDA #$88<br />	STA $0200                          ; set tile.y pos<br />	LDA #$02<br />	STA $0201                          ; set tile.id<br />	LDA #$00<br />	STA $0202                          ; set tile.attribute<br />@marker: <br />	LDA #$88<br />	STA $0204                          ; set tile.y pos<br />	LDA #$03<br />	STA $0205                          ; set tile.id<br />	LDA #$00<br />	STA $0206                          ; set tile.attribute<br /><br />EnableSprites: <br />	LDA #%10000000                     ; enableNMI sprites0 background0<br />	STA PPUCTRL<br />	LDA #%00011110                     ; sprites background noclip<br />	STA PPUMASK<br /><br />;; main phase<br /><br />MAIN: <br />	LDA btnqueue<br />@style1: <br />	CMP BUTTON_LEFT<br />	BEQ MoveLeft<br />	CMP BUTTON_RIGHT<br />	BEQ MoveRight<br />	CMP BUTTON_UP<br />	BEQ MoveUp<br />	CMP BUTTON_DOWN<br />	BEQ MoveDown<br />@style2: <br />	CMP BUTTON_SELECT<br />	BEQ ResetSequence<br />	CMP BUTTON_START<br />	BEQ MoveMarker<br />	CMP BUTTON_A<br />	BEQ MoveUp<br />	CMP BUTTON_B<br />	BEQ MoveDown<br />	JMP MAIN                           ; infinite loop<br /><br />;; General functions<br /><br />MoveLeft: <br />	DEC cursor<br />	LDA cursor<br />	CMP #$ff<br />	BNE @done                          ; when equal skip<br />	LDA #$0f                           ; wrap around<br />	STA cursor<br />@done: <br />	JMP MoveEnd<br /><br />MoveRight: <br />	INC cursor<br />	LDA cursor<br />	CMP #$10<br />	BCC @done                          ; when greaterthan skip<br />	LDA #$00                           ; wrap around<br />	STA cursor<br />@done: <br />	JMP MoveEnd<br /><br />MoveDown: <br />	LDX cursor<br />	DEC $10,x<br />	LDA $10,x<br />	CMP #$ff                           ; when equal skip<br />	BNE @done                          ; wrap around<br />	LDA #$07<br />	STA $10,x<br />@done: <br />	JMP MoveEnd<br /><br />MoveUp: <br />	LDX cursor<br />	INC $10,x<br />	LDA $10,x<br />	CMP #$08                           ; when greaterthan skip<br />	BCC @done                          ; wrap around<br />	LDA #$00<br />	STA $10,x<br />@done: <br />	JMP MoveEnd<br /><br />MoveMarker: <br />	LDA cursor<br />	STA marker<br />	STA RedrawInterface<br />	JMP MoveEnd<br /><br />ResetSequence: <br />	LDX #$00<br />@loop: <br />	LDA #$01                           ; set entire sequence to "+"<br />	STA $10,x                          ; store on zeropage second row<br />	INX <br />	CPX #$10<br />	BNE @loop<br />	JMP MoveEnd<br /><br />MoveEnd: <br />	LDA #$00<br />	STA btnqueue<br />	STA RedrawTimeline<br />	JMP MAIN<br /><br />;; interface<br /><br />RedrawTimeline: <br />	LDX #$00<br />@loop: <br />	LDA #$22                           ; sprite v pos<br />	STA PPUADDR<br />	TXA                                ; sprite x pos<br />	STA PPUADDR<br />	LDA #$10, x                        ; find selection<br />	CLC <br />	ADC #$10<br />	CPX cursor                         ; if cursor<br />	BNE @continue<br />	CLC <br />	ADC #$08                           ; then, highlight<br />@continue: <br />	STA PPUDATA                        ; sprite id<br />	INX <br />	CPX #$10<br />	BNE @loop<br />	RTS <br /><br />RedrawInterface: <br />	LDA PPUSTATUS<br />@selection: <br />	LDA cursor<br />	CLC <br />	ADC #$20<br />	LDX #$40<br />	LDY #$22<br />	STY PPUADDR<br />	STX PPUADDR<br />	STA PPUDATA<br />@marker: <br />	LDA marker<br />	CLC <br />	ADC #$20<br />	LDX #$41<br />	LDY #$22<br />	STY PPUADDR<br />	STX PPUADDR<br />	STA PPUDATA<br />@position: <br />	LDA position<br />	CLC <br />	ADC #$20<br />	LDX #$42<br />	LDY #$22<br />	STY PPUADDR<br />	STX PPUADDR<br />	STA PPUDATA<br />@rate: <br />	LDA rate<br />	CLC <br />	ADC #$20<br />	LDX #$43<br />	LDY #$22<br />	STY PPUADDR<br />	STX PPUADDR<br />	STA PPUDATA<br />@sprites: <br />	LDA position<br />	ASL <br />	ASL <br />	ASL <br />	CLC <br />	ADC #$40<br />	STA $0203                          ; set tile.x pos<br />	LDA marker<br />	ASL <br />	ASL <br />	ASL <br />	CLC <br />	ADC #$40<br />	STA $0207                          ; set tile.x pos<br />@done: <br />	RTS <br /><br />IncNote: <br />	INC note<br />	LDA note<br />	CMP #$48<br />	BNE @done<br />	LDA #$00                           ; when reached end<br />	STA note                           ; reset note<br />@done: <br />	RTS <br /><br />DecNote: <br />	DEC note<br />	LDA note<br />	CMP #$ff<br />	BNE @done<br />	LDA #$47<br />	STA note<br />@done: <br />	RTS <br /><br />PlaySnare: <br />	LDA #&lt;$3f8<br />	STA APUCH4LEN<br />	LDA #&gt;$3f8<br />	STA APUCH4FRQ<br />	LDA #%11000100<br />	STA APUCH4VOL<br />	RTS <br /><br />;; operators<br /><br />DoInc: <br />	LDX #$00<br />@loop: <br />	JSR IncNote<br />	CPX marker<br />	INX <br />	BCC @loop<br />	JMP DoOperationEnd<br /><br />DoDec: <br />	LDX #$00<br />@loop: <br />	JSR DecNote<br />	CPX marker<br />	INX <br />	BCC @loop<br />	JMP DoOperationEnd<br /><br />DoTop: <br />	LDA #$24<br />	STA note<br />	JMP DoOperationEnd<br /><br />DoBottom: <br />	LDA #$00<br />	STA note<br />	JMP DoOperationEnd<br /><br />DoRandomNote: <br />	LDA seed<br />@loop: <br />	SEC <br />	SBC #$48<br />	CMP #$48<br />	BCS @loop<br />	STA note<br />	INC seed<br />	JSR PlaySnare<br />	JMP DoOperationEnd<br /><br />DoIncMetro: <br />	INC rate<br />	LDA rate<br />	CMP #$0c<br />	BCC @done<br />	LDA #$01<br />	STA rate<br />@done: <br />	JMP DoOperationEnd<br /><br />DoDecMetro: <br />	DEC rate<br />	LDA rate<br />	CMP #$00<br />	BNE @done<br />	LDA #$0c<br />	STA rate<br />@done: <br />	JMP DoOperationEnd<br /><br />DoRandomPosition: <br />	LDA marker<br />	STA position<br />	JMP DoOperationEnd<br /><br />DoOperation: <br />	LDX position<br />	LDA $10,x<br />	CMP #$00<br />	BEQ DoInc<br />	CMP #$01<br />	BEQ DoDec<br />	CMP #$02<br />	BEQ DoBottom<br />	CMP #$03<br />	BEQ DoTop<br />	CMP #$04<br />	BEQ DoRandomNote<br />	CMP #$05<br />	BEQ DoIncMetro<br />	CMP #$06<br />	BEQ DoDecMetro<br />	CMP #$07<br />	BEQ DoRandomPosition<br /><br />DoOperationEnd: ; return from operations<br />	RTS <br /><br />DoSound: <br />	LDX note<br />@ch1: <br />	LDA NotesHi,x<br />	STA APUCH1LEN<br />	LDA NotesLo,x<br />	STA APUCH1FRQ<br />	LDY position<br />	STY APUCH1SWP<br />@ch2: <br />	LDA NotesHi,x<br />	STA APUCH2LEN<br />	LDA NotesLo,x<br />	STA APUCH2FRQ<br />	LDY marker<br />	STY APUCH2SWP<br />@ch3: <br />	LDA NotesHi,x<br />	STA APUCH3LEN<br />	LDA NotesLo,x<br />	STA APUCH3FRQ<br />	LDY timer<br />	STY APUCH3SWP<br />	RTS <br /><br />;; nmi phase<br /><br />NMI: ;<br /><br />ReadJoy: <br />	LDA #$01<br />	STA JOY1                           ; start reading<br />	STA btndown<br />	LSR a<br />	STA JOY1<br />@loop: <br />	LDA JOY1<br />	LSR a<br />	ROL btndown<br />	BCC @loop<br /><br />SaveJoy: <br />	LDA btndown<br />	CMP btnlast<br />	BEQ @done<br />	STA btnlast<br />	CMP #$00<br />	BEQ @done<br />	STA btnqueue<br />@done: <br />	LDA #$00<br />	STA SPRADDR<br />	LDA #$02<br />	STA $4014<br /><br />RunTimer: <br />	INC seed<br />	INC timer<br />	LDA timer<br />	CMP rate                           ; check if timer has reached rate<br />	BNE @done                          ; skip if timer is less than rate<br />	LDA #$00<br />	STA timer                          ; reset timer<br />	JSR DoOperation<br />	JSR DoSound<br />	INC position<br />	LDA position<br />	CMP #$10                           ; check if position has reached 16<br />	BNE @done<br />	LDA #$00<br />	STA position<br />@done: <br /><br />Cleanup: <br />	JSR RedrawTimeline<br />	JSR RedrawInterface<br />	LDA PPUSTATUS<br />	LDA #$c0                           ; shift background to center<br />	STA PPUSCROLL<br />	LDA #$00<br />	STA PPUSCROLL<br />	RTI                                ; return from interrupt<br /><br />;; tables<br /><br />	.org $E000<br /><br />Palettes: ;<br />	.db $0F,$3B,$16,$30, $3B,$3B,$0F,$0F, $0F,$3B,$0F,$0F, $0F,$3B,$0F,$0F<br />	.db $0F,$3B,$16,$3B, $0F,$3B,$0F,$0F, $0F,$0F,$0F,$0F, $0F,$0F,$0F,$0F<br /><br />ApuStates: <br />	.db #%10100111,$08,$00,$00<br />	.db #%00011101,$08,$00,$00<br />	.db #%01011101,$08,$00,$00<br />	.db #%01011011,$08,$00,$00<br /><br />NotesHi: <br />	.db $07,$07,$07,$06,$06,$05,$05,$05,$05,$04,$04,$04<br />	.db $03,$03,$03,$03,$03,$02,$02,$02,$02,$02,$02,$02<br />	.db $01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br /><br />NotesLo: <br />	.db $f1,$7f,$13,$ad,$4d,$f3,$9d,$4c,$00,$b8,$74,$34<br />	.db $f8,$bf,$89,$56,$26,$f9,$ce,$a6,$80,$5c,$3a,$1a<br />	.db $fb,$df,$c4,$ab,$93,$7c,$67,$52,$3f,$2d,$1c,$0c<br />	.db $fd,$ef,$e1,$d5,$c9,$bd,$b3,$a9,$9f,$96,$8e,$86<br />	.db $7e,$77,$70,$6a,$64,$5e,$59,$54,$4f,$4b,$46,$42<br />	.db $3f,$3b,$38,$34,$31,$2f,$2c,$29,$27,$25,$23,$21<br /><br />;; Vectors<br /><br />	.pad $FFFA<br />	.dw NMI<br />	.dw RESET<br />	.dw 0<br /><br />;; Sprites<br /><br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $fe,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$fe,$00,$00,$00,$00,$00,$00,$00<br />	.db $fe,$00,$00,$00,$00,$00,$00,$00,$fe,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $10,$10,$10,$fe,$10,$10,$10,$00,$10,$10,$10,$fe,$10,$10,$10,$00<br />	.db $00,$00,$00,$fe,$00,$00,$00,$00,$00,$00,$00,$fe,$00,$00,$00,$00<br />	.db $04,$08,$10,$20,$10,$08,$04,$00,$04,$08,$10,$20,$10,$08,$04,$00<br />	.db $20,$10,$08,$04,$08,$10,$20,$00,$20,$10,$08,$04,$08,$10,$20,$00<br />	.db $10,$54,$28,$c6,$28,$54,$10,$00,$10,$54,$28,$c6,$28,$54,$10,$00<br />	.db $ec,$92,$92,$92,$92,$92,$92,$00,$ec,$92,$92,$92,$92,$92,$92,$00<br />	.db $92,$92,$92,$92,$92,$92,$ec,$00,$92,$92,$92,$92,$92,$92,$ec,$00<br />	.db $10,$28,$44,$82,$44,$28,$10,$00,$10,$28,$44,$82,$44,$28,$10,$00<br />	.db $10,$10,$10,$fe,$10,$10,$10,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $00,$00,$00,$fe,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $04,$08,$10,$20,$10,$08,$04,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $20,$10,$08,$04,$08,$10,$20,$00,$00,$00,$00,$00,$00,$00,$00,$00<br />	.db $10,$54,$28,$c6,$28,$54,$10,$00,$00,$00,$00,$0</main><footer><a href="https://creativecommons.org/licenses/by-nc-sa/4.0" target="_blank"><img src="../media/icon/cc.svg" alt="CreativeCommons"/></a><a href="http://webring.xxiivv.com/" target="_blank"><img src="../media/icon/webring.svg" alt="Webring"/></a><a href="https://merveilles.town/@neauoire" target="_blank"><img src="../media/icon/merveilles.svg" alt="Merveilles"/></a><span><a href="devine_lu_linvega.html">Devine Lu Linvega</a> &copy; 2021 &mdash; <a href="about.html">BY-NC-SA 4.0</a></span></footer></body></html>