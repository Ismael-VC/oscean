<!DOCTYPE html><html><head><meta charset="utf-8"/><link href="../links/main.css" type="text/css" rel="stylesheet"/><link href="../media/services/icon.png" type="image/png" rel="shortcut icon"/><title>XXIIVV &mdash; tga format</title></head><body><header><a href="home.html"><img alt="XXIIVV" src="../media/icon/logo.svg"/></a></header><nav><ul><li><a href="roms.html">roms</a></li><li><a href="tools.html">tools</a></li><li><a href="utilities.html">utilities</a></li><li><a href="formats.html" class="parent">formats</a></li><li><a href="games.html">games</a></li><li><a href="toys.html">toys</a></li><li><a href="mobile.html">mobile</a></li><li><a href="unreleased.html">unreleased</a></li></ul><ul><li><a href="icn_format.html">icn format</a></li><li><a href="chr_format.html">chr format</a></li><li><a href="gly_format.html">gly format</a></li><li><a href="ufx_format.html">ufx format</a></li><li><a href="tga_format.html" class="self">tga format</a></li></ul><ul></ul></nav><main><h2>Truevision TGA is a raster graphics file format created by Truevision.</h2>

<p>TGA files are currently used as the standard image transfer format between <a href="varvara.html">Varvara</a> and the host operating system.</p>

<table border="1">
	<tr><th>Length</th><th>Field name</th><th>Description</th></tr>
	<tr><td>1 byte</td><td>ID length</td><td>Length of the image ID field</td></tr>
	<tr><td>1 byte</td><td>Color map type</td><td>Whether a color map is included</td></tr>
	<tr><td>1 byte</td><td>Image type</td><td>Compression and color types</td></tr>
	<tr><td>5 bytes</td><td>Color map specification</td><td>Describes the color map</td></tr>
	<tr><th colspan="3">Specification</th></tr>
	<tr><td>2 bytes</td><td>X-origin</td><td>absolute x of lower-left corner</td></tr>
	<tr><td>2 bytes</td><td>Y-origin</td><td>absolute y of lower-left corner</td></tr>
	<tr><td>2 bytes</td><td>Image width</td><td>width in pixels</td></tr>
	<tr><td>2 bytes</td><td>Image height</td><td>height in pixels</td></tr>
	<tr><td>1 byte</td><td>Pixel depth</td><td>bits per pixel</td></tr>
	<tr><td>1 byte</td><td>Image descriptor</td><td>bits 3-0 give the alpha channel depth, bits 5-4 give direction</td></tr>
</table>

<h3>Image ID length</h3>

<p>0–255 The number of bytes that the image ID field consists of. The image ID field can contain any information, but it is common for it to contain the date and time the image was created or a serial number.</p>

<h3>Color map type</h3>

<ul>
	<li>0 if image file contains no color map</li>
	<li>1 if present</li>
	<li>2–127 reserved by Truevision</li>
	<li>128–255 available for developer use</li>
</ul>

<h3>Image type</h3>

<p>Enumerated in the lower three bits, with the fourth bit as a flag for RLE.  Some possible values are:</p>

<ul>
	<li>0  no image data is present</li>
	<li>1  uncompressed color-mapped image</li>
	<li>2  uncompressed true-color image</li>
	<li>3  uncompressed black-and-white (grayscale) image</li>
	<li>9  run-length encoded color-mapped image</li>
	<li>10 run-length encoded true-color image</li>
	<li>11 run-length encoded black-and-white (grayscale) image</li>
</ul>

<p>Image type 1 and 9: Depending on the Pixel Depth value, image data representation is an 8, 15, or 16 bit index into a color map that defines the color of the pixel.
Image type 2 and 10: The image data is a direct representation of the pixel color. For a Pixel Depth of 15 and 16 bit, each pixel is stored with 5 bits per color. If the pixel depth is 16 bits, the topmost bit is reserved for transparency. For a pixel depth of 24 bits, each pixel is stored with 8 bits per color. A 32-bit pixel depth defines an additional 8-bit alpha channel. Image type 3 and 11: The image data is a direct representation of grayscale data. The pixel depth is 8 bits for images of this type.</p>

<h3>Color map specification</h3>

<ul>
	<li>First entry index (2 bytes): index of first color map entry that is included in the file</li>
	<li>Color map length (2 bytes): number of entries of the color map that are included in the file</li>
	<li>Color map entry size (1 byte): number of bits per pixel</li>
</ul>

<p>In case that not the entire color map is actually used by the image, a non-zero first entry index allows to store only a required part of the color map in the file.</p>

<h3>Uxntal Implementation</h3>

<p>Here is an <a href='uxntal.html'>Uxntal</a> implementation to draw an uncompressed TGA image in <a href='varvara.html'>Varvara</a>:</p>

<pre>
%FLIP { STH2k LDA2 SWP STH2r STA2 }

@tga
	&id-length $1
	&color-map $1
	&image-type $1
	&map $5
	&position &x $2 &y $2
	&size &w $2 &h $2
	&depth $1
	&descriptor $1

@draw-tga ( addr* -- )

	( header )
	.File/name DEO2
	#0012 .File/length DEO2
	;tga .File/read DEO2
	( flip endianness )
	;tga/x FLIP ;tga/y FLIP
	;tga/w FLIP ;tga/h FLIP
	( get parser )
	;tga/image-type LDA
	#02 !~ ,&no-rawt JCN
		;tga-rawt #0004 ,parse-tga JSR
		POP RTN
		&no-rawt
	#03 !~ ,&no-rawm JCN
		;tga-rawm #0001 ,parse-tga JSR
		POP RTN
		&no-rawm
	( error )
	;&error-unknown-txt ;print-str JSR2
	;tga/image-type LDA 2* TOS ;tga-types ++ LDA2 PRINT

RTN
	&error-unknown-txt "Unsupported 20 "image-type: 20 $1

@parse-tga ( filter* length* -- )

	.File/length DEO2 ,&filter STR2
	.Screen/x DEI2 ,&x STR2
	AUTO-X
	LIT2r 0000
	&stream
		;&pixel
			DUP2 .File/read DEO2
			[ LIT2 &filter $2 ] JSR2 .Screen/pixel DEO
		INC2r
		( skip line )
		STH2kr ;tga/w LDA2 !! ,&continue JCN
			[ LIT2 &x $2 ] .Screen/x DEO2
			POP2r LIT2r 0000
			.Screen/y DEI2k INC2 ROT DEO2
			&continue
		.File/success DEI2 #0000 !! ,&stream JCN
	POP2r
	AUTO-NONE

RTN
	&pixel $4

( pixel filters )

@tga-rawt ( rgba* -- color )

	STH2
	( b ) #00 STH2kr LDA INC2r
	( g ) #00 STH2kr LDA INC2r
	( r ) #00 STH2r LDA
	( res ) ++ ++ #0003 // NIP 40/

RTN

@tga-rawm ( grey* -- color )

	( res ) LDA 40/

RTN

@tga-types-txts
	&null "missing-type $1
	&rawc "RAW-color $1
	&rawt "RAW-true $1
	&rawm "RAW-mono $1
	&rlec "RLE-color $1
	&rlet "RLE-true $1
	&rlem "RLE-mono $1
	&void "unknown-type $1

@tga-types
	:tga-types-txts/null :tga-types-txts/rawc
	:tga-types-txts/rawt :tga-types-txts/rawm
	:tga-types-txts/void :tga-types-txts/void
	:tga-types-txts/void :tga-types-txts/void
	:tga-types-txts/void :tga-types-txts/rlec
	:tga-types-txts/rlet :tga-types-txts/rlem
</pre>

<ul>
	<li><a href='https://git.sr.ht/~rabbits/tga-format' target='_blank'>view source</a></li>
</ul>
<ul></ul><p><b>Incoming</b>: <a href="noodle.html">noodle</a> <a href="adelie.html">adelie</a> <a href="dito.html">dito</a> <a href="chr_format.html">chr format</a> <a href="2022.html">2022</a> <a href="2021.html">2021</a> </p></main>
<footer><a href="https://creativecommons.org/licenses/by-nc-sa/4.0" target="_blank"><img src="../media/icon/cc.svg" alt="CreativeCommons"/></a><a href="https://webring.xxiivv.com/" target="_blank"><img src="../media/icon/webring.svg" alt="Webring"/></a><a href="https://merveilles.town/@neauoire" rel="me" target="_blank"><img src="../media/icon/merveilles.svg" alt="Merveilles"/></a><a href="uxn.html"><img src="../media/icon/uxn.svg" alt="Uxn Powered"/></a><span><a href="devine_lu_linvega.html">Devine Lu Linvega</a> &copy; 2022 &mdash; <a href="about.html">BY-NC-SA 4.0</a></span></footer></body></html>